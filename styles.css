:root {
        --paper: #fcfcfa;
        --ink: #151515;
        --muted: #6b6b6b;
        --line: rgba(0, 0, 0, 0.18);
        --accent: #c1121f;
        --bg: #f4f4f2;
        --bg-soft: #ececea;
        --border: rgba(0, 0, 0, 0.22);
        --warn: #a06a24;
        --danger: #c1121f;
        --success: #2f5c47;
        --primary: var(--ink);
        --secondary: #efecea;
        --ticket: #fbfbf9;
        --done: #f0eeec;
        --shadow: 0 8px 20px rgba(21, 21, 21, 0.12);
        --radius: 8px;
        --font-sans: "Bahnschrift", "Segoe UI", "Trebuchet MS", "Tahoma", sans-serif;
        --font-mono: "Cascadia Mono", "Consolas", "Courier New", monospace;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: var(--font-sans);
        color: var(--ink);
        background-color: var(--bg);
        background-image:
          radial-gradient(circle at 18% 22%, rgba(0, 0, 0, 0.04), transparent 45%),
          radial-gradient(circle at 78% 28%, rgba(0, 0, 0, 0.03), transparent 40%),
          radial-gradient(circle at 50% 78%, rgba(0, 0, 0, 0.025), transparent 45%),
          repeating-linear-gradient(90deg, rgba(0, 0, 0, 0.018) 0 1px, transparent 1px 7px),
          repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.012) 0 1px, transparent 1px 6px);
        min-height: 100vh;
        padding-top: 0;
        position: relative;
      }

      body::before {
        content: '';
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image:
          radial-gradient(circle at 12% 18%, rgba(0, 0, 0, 0.08), transparent 55%),
          radial-gradient(circle at 82% 30%, rgba(0, 0, 0, 0.06), transparent 55%),
          radial-gradient(circle at 30% 78%, rgba(0, 0, 0, 0.05), transparent 50%),
          repeating-linear-gradient(120deg, rgba(0, 0, 0, 0.04) 0 1px, transparent 1px 18px);
        opacity: 0.15;
        z-index: 0;
      }

      html {
        scroll-padding-top: var(--topbar-h, 86px);
      }

      .app {
        max-width: 1280px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
        z-index: 1;
      }

      .prep-layout {
        display: grid;
        grid-template-columns: minmax(240px, 360px) minmax(0, 1fr);
        gap: 16px;
        align-items: start;
      }

      .prep-sidebar,
      .prep-main {
        display: grid;
        gap: 16px;
      }

      .kitchen-layout {
        display: grid;
        gap: 16px;
      }

      .kitchen-main {
        display: grid;
        gap: 16px;
      }

      .screen {
        display: block;
      }

      body.screen-library #plan-screen {
        display: none;
      }

      body.screen-plan #library-screen {
        display: none;
      }

      .library-topbar {
        border: 1px solid var(--border);
        padding: 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        background: var(--ticket);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
      }

      .library-body {
        margin-top: 16px;
        display: grid;
        gap: 16px;
      }

      .library-filters {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }

      .recipe-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
      }

      .recipe-card {
        border: 1px dashed var(--border);
        padding: 10px;
        background: var(--ticket);
        display: grid;
        gap: 6px;
      }

      .recipe-card.active {
        border-color: var(--ink);
      }

      .recipe-title {
        font-size: 13px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-family: var(--font-sans);
      }

      .recipe-meta,
      .recipe-tags {
        font-size: 11px;
        color: var(--muted);
      }

      .recipe-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .topbar {
        border-bottom: 1px solid var(--border);
        padding: 8px 14px;
        display: grid;
        grid-template-columns: auto minmax(0, 1fr) auto;
        gap: 12px;
        align-items: center;
        background: var(--ticket);
        box-shadow: 0 8px 18px rgba(16, 14, 12, 0.08);
        position: sticky;
        top: 0;
        left: 0;
        right: 0;
        z-index: 50;
        min-height: 64px;
      }

      .topbar-left {
        display: grid;
        gap: 2px;
        min-width: 0;
      }

      .topbar-right {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: flex-end;
        gap: 8px;
      }

      @media (max-width: 920px) {
        .topbar {
          grid-template-columns: 1fr;
          align-items: start;
        }

        .nav-tabs {
          flex-wrap: wrap;
          justify-content: flex-start;
        }

        .topbar-right {
          justify-content: flex-start;
        }
      }

      .top-center {
        display: grid;
        justify-items: center;
        gap: 2px;
        min-width: 0;
      }

      .top-actions {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: flex-end;
        gap: 10px;
      }

      .nav-tabs {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        justify-content: center;
        justify-self: center;
      }

      .nav-tabs .btn {
        border-bottom: 2px solid transparent;
        font-family: var(--font-sans);
      }

      .nav-tabs .btn.active {
        border-bottom-color: var(--accent);
      }

      .badge-button {
        background: none;
        border: none;
        padding: 0;
        cursor: pointer;
      }

      .badge-button:focus-visible {
        outline: 2px solid var(--ink);
        outline-offset: 2px;
      }

      .jump-highlight {
        outline: 2px solid var(--warn);
        outline-offset: 4px;
      }

      body.screen-library .topbar .status-strip,
      body.screen-library .topbar #phase-state,
      body.screen-library .topbar #phase-timer-note,
      body.screen-library .topbar #auto-review,
      body.screen-library .topbar #start-service,
      body.screen-library .topbar #advanced-toggle {
        display: none;
      }

      .brand {
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        font-weight: 700;
        display: grid;
        gap: 2px;
      }

      .brand-name {
        font-size: 11px;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        font-family: var(--font-sans);
      }

      .brand-context {
        font-size: 13px;
        font-weight: 700;
        font-family: var(--font-sans);
        letter-spacing: 0.12em;
        text-transform: uppercase;
      }

      .status-strip {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
        font-size: 11px;
        justify-content: center;
        font-family: var(--font-sans);
      }

      .service-panel {
        justify-content: flex-start;
      }

      body.mode-kitchen .service-panel #phase-state {
        display: inline-flex;
      }

      body.mode-kitchen .service-panel #phase-timer-note {
        display: inline;
      }

      .status-notes {
        display: none;
        gap: 8px;
        font-size: 10px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-family: var(--font-sans);
      }

      body.expert .status-notes {
        display: flex;
      }

      .status-badge.health {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-family: var(--font-sans);
      }

      .status-badge.health::before {
        content: '';
        width: 10px;
        height: 10px;
        border-radius: 2px;
        background: var(--muted);
        display: inline-block;
      }

      .status-badge.health.ok::before {
        background: var(--success);
      }

      .status-badge.health.warn::before {
        background: var(--warn);
      }

      .status-badge.health.error::before {
        background: var(--danger);
      }

      #plan-screen {
        padding-bottom: 76px;
      }

      .status-timer.hidden {
        display: none;
      }

      .kitchen-footer {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--ticket);
        border-top: 1px dashed var(--border);
        padding: 10px 14px;
        display: flex;
        justify-content: center;
        gap: 10px;
        z-index: 20;
        box-shadow: 0 -8px 18px rgba(16, 14, 12, 0.08);
      }

      body.mode-prep .kitchen-footer {
        display: none;
      }

      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        text-transform: uppercase;
        letter-spacing: 0.14em;
        font-weight: 700;
        background: var(--ticket);
        font-family: var(--font-sans);
      }

      .status-badge.phase {
        border-color: var(--ink);
        padding: 6px 10px;
        font-size: 12px;
        border-radius: 6px;
      }

      .status-badge.ok {
        background: #e8f4ec;
        border-color: #98c8ab;
        color: #1f5a37;
      }

      .status-badge.warn {
        background: #fff5db;
        border-color: #f0c96b;
        color: #8a5a00;
      }

      .status-badge.error {
        background: #fdecec;
        border-color: #d99a9a;
        color: #8b1a1a;
      }

      .status-timer {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        border: 1px dashed var(--border);
        border-radius: 999px;
        font-weight: 700;
        letter-spacing: 0.08em;
        background: var(--ticket);
        font-family: var(--font-mono);
      }

      #phase-state,
      #phase-timer-note {
        display: none;
      }

      .label {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        color: var(--muted);
        font-family: var(--font-sans);
      }

      .value {
        font-size: 18px;
        font-weight: 700;
      }

      .value.warn {
        color: var(--warn);
      }

      .note {
        font-size: 12px;
        color: var(--muted);
        font-family: var(--font-mono);
      }

      .summary-status {
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-family: var(--font-sans);
      }

      .summary-meta {
        font-size: 12px;
        color: var(--muted);
      }

      #ai-summary-content {
        font-family: var(--font-mono);
        line-height: 1.5;
      }

      #ai-summary-content .summary-meta {
        margin-top: 4px;
        padding-left: 14px;
        border-left: 1px dotted var(--line);
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        align-items: center;
      }

      .main-actions .btn {
        font-size: 12px;
      }

      .main-actions {
        justify-content: flex-end;
      }

      .library-only {
        display: none;
      }

      body.screen-library .library-only {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .more-menu {
        position: relative;
      }

      .more-menu summary {
        list-style: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .more-menu summary::-webkit-details-marker {
        display: none;
      }

      .more-menu-panel {
        margin-top: 6px;
        border: 1px solid var(--border);
        padding: 8px;
        background: var(--ticket);
        display: none;
        gap: 6px;
        border-radius: 8px;
      }

      .more-menu[open] .more-menu-panel {
        display: grid;
      }

      .more-menu[open] .more-menu-panel {
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      }

      .hidden {
        display: none !important;
      }

      [hidden] {
        display: none !important;
      }

      .mode-toggle {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 6px;
      }

      .panel-actions .mode-toggle,
      .more-menu-panel .mode-toggle {
        margin-top: 0;
      }

      .mode-toggle .btn.active {
        background: var(--ink);
        color: var(--bg);
      }

      .btn {
        border: 1px solid var(--border);
        background: var(--secondary);
        color: var(--ink);
        padding: 7px 12px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-size: 11px;
        font-family: var(--font-sans);
        cursor: pointer;
        border-radius: 6px;
      }

      .btn.ghost {
        background: transparent;
        color: var(--ink);
        border-color: var(--border);
      }

      .btn.primary {
        background: var(--accent);
        color: #fff;
        border-color: var(--accent);
      }

      .btn.success {
        background: var(--success);
        color: #fff;
        border-color: var(--success);
      }

      .btn.danger {
        background: transparent;
        color: var(--accent);
        border-color: var(--accent);
      }

      .btn:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }

      .section {
        margin-top: 16px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 14px;
        background: var(--ticket);
        box-shadow: var(--shadow);
        position: relative;
        font-family: var(--font-mono);
        background-image:
          linear-gradient(0deg, rgba(0, 0, 0, 0.02) 0, rgba(0, 0, 0, 0.02) 1px, transparent 1px, transparent 6px),
          radial-gradient(circle at 18% 30%, rgba(0, 0, 0, 0.04), transparent 55%),
          radial-gradient(circle at 75% 80%, rgba(0, 0, 0, 0.03), transparent 50%);
        background-blend-mode: multiply;
      }

      .wizard {
        display: grid;
        gap: 16px;
        margin-top: 16px;
      }

      .step {
        border: 1px solid var(--border);
        background: var(--ticket);
        padding: 12px;
        display: grid;
        gap: 10px;
      }

      .step-header {
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 6px;
      }

      .step-index {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        padding: 4px 8px;
        border: 1px solid var(--border);
        background: var(--bg-soft);
        font-family: var(--font-sans);
      }

      .step-title {
        font-size: 15px;
        font-weight: 700;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        font-family: var(--font-sans);
      }

      .step-body {
        display: grid;
        gap: 12px;
      }

      .config-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 10px;
        margin-top: 8px;
      }

      .config-block {
        border: 1px dashed var(--border);
        padding: 10px;
        background: var(--ticket);
        display: grid;
        gap: 6px;
        border-radius: 6px;
      }

      .config-row {
        display: grid;
        gap: 6px;
        grid-template-columns: 1fr 70px 90px 32px;
        align-items: center;
      }

      .config-row.team {
        grid-template-columns: 1fr 0.9fr 60px 32px;
      }

      .mini-btn {
        padding: 4px 6px;
        font-size: 10px;
      }

      .section-title {
        font-size: 13px;
        letter-spacing: 0.22em;
        text-transform: uppercase;
        margin-bottom: 10px;
        font-family: var(--font-sans);
        position: relative;
      }

      .section-title::before {
        content: '';
        display: block;
        height: 6px;
        width: 90px;
        margin-bottom: 6px;
        background: repeating-linear-gradient(90deg, var(--ink) 0 2px, transparent 2px 4px);
        opacity: 0.35;
      }

      .section-title::after {
        content: '';
        display: block;
        margin-top: 8px;
        border-top: 2px solid transparent;
        border-image: repeating-linear-gradient(90deg, var(--line) 0 6px, transparent 6px 12px) 1;
        opacity: 0.7;
      }

      .perforated-divider {
        position: relative;
        height: 12px;
        margin: 8px 0;
      }

      .perforated-divider::before {
        content: '';
        position: absolute;
        left: 0;
        right: 0;
        top: 50%;
        border-top: 1px dashed var(--line);
        transform: translateY(-50%);
      }

      .perforated-divider::after {
        content: '';
        position: absolute;
        left: -6px;
        right: -6px;
        top: 50%;
        height: 12px;
        transform: translateY(-50%);
        background:
          radial-gradient(circle at left center, var(--paper) 0 5px, transparent 6px),
          radial-gradient(circle at right center, var(--paper) 0 5px, transparent 6px);
      }

      .ticket-header {
        font-family: var(--font-sans);
        text-transform: uppercase;
        letter-spacing: 0.18em;
        font-size: 12px;
      }

      .ticket-divider {
        position: relative;
        height: 10px;
        margin: 8px 0;
      }

      .ticket-divider::before {
        content: '';
        position: absolute;
        left: 0;
        right: 0;
        top: 50%;
        border-top: 2px solid transparent;
        border-image: repeating-linear-gradient(90deg, var(--line) 0 6px, transparent 6px 12px) 1;
        opacity: 0.7;
      }

      .ticket-divider::after {
        content: '';
        position: absolute;
        left: -6px;
        right: -6px;
        top: 50%;
        height: 10px;
        transform: translateY(-50%);
        background:
          radial-gradient(circle at left center, var(--paper) 0 5px, transparent 6px),
          radial-gradient(circle at right center, var(--paper) 0 5px, transparent 6px);
        opacity: 0.9;
      }

      .drop-zone {
        border: 1px dashed var(--line);
        background: var(--ticket);
        padding: 18px;
        text-align: center;
        cursor: pointer;
        display: grid;
        gap: 6px;
        border-radius: 8px;
      }

      .drop-zone .btn.primary {
        padding: 10px 14px;
        font-size: 12px;
      }

      .drop-zone.hover {
        border-color: var(--ink);
        background: var(--bg-soft);
      }

      .drop-title {
        font-size: 13px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-family: var(--font-sans);
      }

      .drop-sub {
        font-size: 11px;
        color: var(--muted);
      }

      .text-input {
        width: 100%;
        min-height: 90px;
        margin-top: 8px;
        padding: 8px;
        border: 1px dashed var(--line);
        font-family: var(--font-mono);
        font-size: 12px;
        background: var(--ticket);
        border-radius: 6px;
      }

      .text-input.debug {
        min-height: 120px;
      }

      .alert-box {
        border: 1px dashed var(--border);
        padding: 10px;
        display: grid;
        gap: 6px;
        background: var(--ticket);
      }

      .alert-title {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        font-weight: 700;
        font-family: var(--font-sans);
      }

      .alert-panel {
        border: 1px dashed var(--border);
        padding: 10px;
        margin-top: 8px;
        display: none;
        gap: 10px;
        background: var(--ticket);
      }

      .alert-panel.show {
        display: grid;
      }

      .alert-section {
        border-top: 1px dashed var(--border);
        padding-top: 8px;
        display: grid;
        gap: 6px;
      }

      .debug-panel {
        border: 1px dashed var(--border);
        margin-top: 8px;
        display: none;
        padding: 8px;
        background: var(--ticket);
      }

      .debug-panel.show {
        display: block;
      }

      .debug-panel summary {
        cursor: pointer;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 6px;
        font-family: var(--font-sans);
      }

      .debug-panel .note.debug {
        font-size: 12px;
        border-top: 1px dashed var(--border);
        padding-top: 6px;
        margin-top: 6px;
        white-space: pre-wrap;
      }

      .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 8px;
        padding: 8px;
        border: 1px dashed var(--line);
        border-radius: 6px;
        background: var(--ticket);
      }

      .table-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
        margin-top: 6px;
      }

      .plan-issues {
        margin-top: 8px;
        border: 1px solid var(--border);
        padding: 8px;
        display: grid;
        gap: 6px;
        background: var(--ticket);
      }

      .assign-grid {
        display: grid;
        gap: 0;
        border-top: 1px dashed var(--border);
        margin-top: 8px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        font-family: var(--font-mono);
      }

      .review-empty {
        margin-top: 12px;
      }

      .prep-screen {
        display: grid;
        gap: 14px;
      }

      .issue-grid {
        display: grid;
        gap: 8px;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }

      .issue-card {
        border: 1px dashed var(--border);
        padding: 10px;
        background: var(--ticket);
        display: grid;
        gap: 6px;
        border-radius: 6px;
      }

      .issue-card.error {
        border-color: var(--danger);
        background: #fdecec;
      }

      .issue-card.warn {
        border-color: var(--warn);
        background: #fff4d6;
      }

      .issue-title {
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-family: var(--font-sans);
      }

      .issue-meta {
        font-size: 11px;
        color: var(--muted);
      }

      .context-grid {
        display: grid;
        gap: 10px;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }

      .context-block {
        border: 1px dashed var(--border);
        padding: 10px;
        background: var(--ticket);
      }

      .ready-title {
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-family: var(--font-sans);
      }

      .assign-row {
        display: grid;
        grid-template-columns: minmax(180px, 1.2fr) 0.7fr 0.7fr 0.9fr 0.6fr;
        gap: 8px;
        padding: 6px 0;
        border-bottom: 1px dashed var(--line);
        font-size: 11px;
        align-items: center;
        min-width: 640px;
      }

      body.expert .assign-row {
        grid-template-columns: minmax(180px, 1.2fr) 0.7fr 0.7fr 0.7fr 0.7fr 0.6fr 0.7fr 0.6fr;
        min-width: 820px;
      }

      .assign-grid[data-mode='prep'] .assign-row {
        grid-template-columns: minmax(180px, 1.2fr) 0.7fr 0.7fr 0.8fr 0.6fr 0.7fr;
        min-width: 760px;
      }

      .assign-row.header {
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-family: var(--font-sans);
      }

      .assign-row.incomplete,
      .assign-row.missing {
        background: #fdecec;
        border-left: 3px solid var(--danger);
        padding-left: 6px;
      }

      .assign-row.invalid {
        color: var(--danger);
        background: #f5f5f5;
      }

      .assign-row.incomplete.invalid {
        background: #fdecec;
      }

      .assign-row.warning {
        background: #fff4d6;
        border-left: 3px solid #e0b542;
        padding-left: 6px;
      }

      .assign-row.low {
        background: #f3f3f3;
      }

      .state-icon {
        display: inline-block;
        min-width: 16px;
        text-align: center;
        margin-right: 4px;
      }

      .badge {
        display: inline-block;
        font-size: 9px;
        padding: 3px 6px;
        border: 1px solid var(--border);
        text-transform: uppercase;
        letter-spacing: 0.14em;
        font-family: var(--font-sans);
        border-radius: 3px;
      }

      .badge.incomplete {
        border-color: var(--danger);
        color: var(--danger);
      }

      .badge.warning {
        border-color: #e0b542;
        color: #8a5a00;
      }

      .badge.state {
        color: var(--accent);
        border-color: var(--accent);
        background: rgba(176, 27, 36, 0.08);
        font-weight: 700;
        letter-spacing: 0.18em;
      }

      .stamp {
        color: var(--accent);
        border: 2px solid var(--accent);
        padding: 4px 10px;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        font-weight: 700;
        background: rgba(176, 27, 36, 0.08);
        transform: rotate(-2deg);
        border-radius: 4px;
        font-family: var(--font-sans);
        box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.15);
      }

      .field-missing {
        border-color: var(--danger);
      }


      .cell strong {
        font-weight: 700;
        display: inline-block;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      select,
      input[type='number'],
      input[type='text'] {
        width: 100%;
        font-family: var(--font-mono);
        font-size: 12px;
        padding: 6px;
        border: 1px dashed var(--border);
        background: var(--ticket);
      }

      .validation {
        margin-top: 8px;
        border-top: 1px dashed var(--border);
        padding-top: 8px;
      }

      .validation-item {
        font-size: 12px;
        margin-bottom: 6px;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 6px;
      }

      .validation-item.error {
        color: var(--danger);
        background: #fdecec;
        border-left: 3px solid var(--danger);
        padding: 6px;
      }

      .validation-item.warn {
        color: var(--warn);
        background: #fff4d6;
        border-left: 3px solid var(--warn);
        padding: 6px;
      }

      .issue-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        align-items: center;
        padding: 6px;
        border: 1px dashed var(--border);
        background: var(--ticket);
        font-size: 11px;
      }

      .issue-bar.error {
        border-color: var(--danger);
        background: #fdecec;
      }

      .issue-bar.warn {
        background: #fff4d6;
      }

      .issue-bar.ok {
        background: #e8f4ec;
        border-color: #98c8ab;
      }

      .issue-panel {
        margin-top: 6px;
        border: 1px dashed var(--border);
        padding: 6px;
        background: var(--ticket);
        display: none;
      }

      .issue-panel.show {
        display: block;
      }

      .settings-panel {
        margin-top: 16px;
        border: 1px solid var(--border);
        padding: 10px;
        background: var(--ticket);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
      }

      .settings-status-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
      }

      #settings-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 8px;
      }

      #settings-issues-toggle {
        margin-top: 8px;
      }

      .settings-issues {
        margin-top: 8px;
        display: none;
      }

      .settings-issues.show {
        display: block;
      }

      .settings-expert-body {
        display: grid;
        gap: 10px;
      }

      .settings-expert-panel {
        display: grid;
        gap: 8px;
      }

      .settings-panel[open] {
        display: block;
      }

      .settings-panel > summary {
        cursor: pointer;
        font-family: var(--font-sans);
        text-transform: uppercase;
        letter-spacing: 0.18em;
      }

      .panel-header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 6px;
        margin-bottom: 8px;
      }

      .panel-title {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        font-family: var(--font-sans);
      }

      .panel-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }

      .settings-block {
        border: 1px solid var(--border);
        padding: 10px;
        display: grid;
        gap: 6px;
        margin-bottom: 8px;
        background: var(--ticket);
        border-radius: calc(var(--radius) - 4px);
      }

      .settings-body {
        display: grid;
        gap: 12px;
        margin-top: 10px;
      }

      details.settings-block {
        padding: 0;
      }

      details.settings-block > summary {
        cursor: pointer;
        padding: 8px;
        font-family: var(--font-sans);
        text-transform: uppercase;
        letter-spacing: 0.14em;
      }

      details.settings-block > .controls,
      details.settings-block > .note {
        padding: 0 8px 8px 8px;
      }

      .block-title {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        font-family: var(--font-sans);
      }

      .block-details {
        border-top: 1px dashed var(--border);
        padding-top: 6px;
        display: grid;
        gap: 6px;
      }

      .block-details summary {
        cursor: pointer;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        font-family: var(--font-sans);
      }

      .danger-zone {
        border-color: var(--danger);
        background: #fdecec;
      }

      .expert-only {
        display: none;
      }

      body.expert .expert-only {
        display: block;
      }

      body.expert .expert-only.controls {
        display: flex;
      }

      body:not(.expert) .expert-only {
        display: none !important;
      }

      .service-only {
        display: none;
      }

      body.service-active .service-only {
        display: grid;
      }

      body.service-active .service-hide {
        display: none;
      }

      body.service-active #auto-review {
        display: none;
      }

      .issue-list {
        display: grid;
        gap: 6px;
        max-height: 220px;
        overflow: auto;
      }

      .issue-item {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
        font-size: 11px;
        border-bottom: 1px dashed var(--line);
        padding-bottom: 4px;
      }

      .issue-actions {
        display: flex;
        gap: 6px;
        flex-shrink: 0;
      }

      .pulse-error {
        animation: pulseError 2s ease;
        border: 1px solid var(--danger);
        background: #fdecec;
      }

      .field-focus {
        border-color: var(--danger);
      }

      @keyframes pulseError {
        0% {
          box-shadow: 0 0 0 0 rgba(176, 0, 0, 0.2);
        }
        70% {
          box-shadow: 0 0 0 6px rgba(176, 0, 0, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(176, 0, 0, 0);
        }
      }

      .questions {
        margin-top: 8px;
        border-top: 1px dashed var(--line);
        padding-top: 8px;
      }

      .question-item {
        font-size: 12px;
        margin-bottom: 6px;
        display: grid;
        gap: 4px;
      }

      .resource-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
      }

      .resource-item {
        border: 1px dashed var(--border);
        padding: 8px;
        background: var(--ticket);
        display: grid;
        gap: 4px;
        border-radius: 6px;
      }

      .resource-item[data-state='occupied'] {
        border-color: #e0b542;
        background: #fff7e0;
      }

      .resource-item[data-state='blocked'] {
        border-color: var(--danger);
        background: #fdecec;
      }

      .resource-item[data-state='free'] {
        border-color: #98c8ab;
        background: #e8f4ec;
      }

      .resource-name {
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        display: flex;
        align-items: center;
        gap: 6px;
        font-family: var(--font-sans);
      }

      .resource-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        border: 1px solid var(--border);
        font-size: 10px;
      }

      .resource-meta {
        font-size: 11px;
        color: var(--muted);
      }

      .line-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 10px;
      }

      .person-column {
        border: 1px dashed var(--border);
        padding: 10px;
        background: var(--ticket);
        display: grid;
        gap: 8px;
        border-radius: 8px;
      }

      .person-header {
        border-bottom: 1px dashed var(--border);
        padding-bottom: 6px;
        display: grid;
        gap: 4px;
      }

      .person-name {
        font-size: 13px;
        font-weight: 700;
        font-family: var(--font-sans);
      }

      .person-role {
        font-size: 11px;
        color: var(--muted);
      }

      .person-state {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        font-family: var(--font-sans);
      }

      .person-lanes {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 8px;
      }

      .lane-col {
        display: grid;
        gap: 6px;
      }

      .lane-title {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--muted);
        font-family: var(--font-sans);
      }

      .person-state.ready {
        color: var(--ink);
      }

      .person-detail {
        font-size: 10px;
        color: var(--muted);
      }

      .column-note {
        font-size: 10px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-family: var(--font-sans);
      }

      .lane {
        display: grid;
        gap: 8px;
        min-height: 120px;
        counter-reset: ticket;
      }

      .ticket {
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 24px 10px 10px;
        background: var(--ticket);
        background-image:
          repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.02) 0 1px, transparent 1px 6px),
          radial-gradient(circle at 20% 35%, rgba(0, 0, 0, 0.04), transparent 60%),
          radial-gradient(circle at 80% 70%, rgba(0, 0, 0, 0.03), transparent 55%);
        display: grid;
        gap: 6px;
        box-shadow: 0 8px 18px rgba(17, 16, 14, 0.1);
        font-family: var(--font-mono);
        position: relative;
        counter-increment: ticket;
      }

      .lane .ticket {
        cursor: pointer;
      }

      .ticket::before,
      .ticket::after {
        content: '';
        position: absolute;
        left: -6px;
        right: -6px;
        height: 12px;
        background:
          radial-gradient(circle at left center, var(--bg) 0 6px, transparent 7px),
          radial-gradient(circle at right center, var(--bg) 0 6px, transparent 7px);
        pointer-events: none;
      }

      .ticket::before {
        top: -6px;
      }

      .ticket::after {
        bottom: -6px;
      }

      .ticket-number {
        position: absolute;
        top: 6px;
        left: 10px;
        font-size: 11px;
        letter-spacing: 0.14em;
        color: var(--muted);
        font-family: var(--font-mono);
      }

      .ticket-number::before {
        content: "#" counter(ticket, decimal-leading-zero);
      }

      .ticket-barcode {
        height: 8px;
        margin-top: 6px;
        background: repeating-linear-gradient(90deg, var(--ink) 0 2px, transparent 2px 5px);
        opacity: 0.35;
      }

      .ticket.pending {
        border-left: 4px solid var(--muted);
      }

      .ticket.active {
        border-left: 4px solid var(--ink);
      }

      .ticket.done {
        background: var(--done);
        opacity: 0.6;
      }

      .ticket.blocked {
        border-left: 4px solid var(--danger);
        background: rgba(176, 27, 36, 0.06);
      }

      .ticket.flash {
        animation: flash 0.5s ease;
      }

      .ticket-title {
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        font-family: var(--font-sans);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        padding-left: 10px;
      }

      .ticket-body {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-family: var(--font-mono);
        color: var(--ink);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        padding-left: 10px;
      }

      .infer-icon {
        display: inline-block;
        font-size: 11px;
        margin-left: 4px;
        color: var(--muted);
      }

      .ticket-line {
        font-size: 11px;
        display: flex;
        justify-content: space-between;
        gap: 6px;
        padding-top: 4px;
        border-top: 1px dashed var(--line);
        padding-left: 10px;
        font-variant-numeric: tabular-nums;
      }

      .ticket-line:first-of-type {
        padding-top: 0;
        border-top: none;
      }

      .ticket-meta {
        font-size: 10px;
        color: var(--muted);
        letter-spacing: 0.12em;
        text-transform: uppercase;
        padding-left: 10px;
      }

      .ticket-alert {
        color: var(--ink);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-family: var(--font-sans);
      }

      .ticket-actions .btn {
        width: 100%;
      }

      .line-phase {
        font-size: 16px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        font-family: var(--font-sans);
      }

      .timer.overdue {
        color: var(--ink);
      }

      .empty {
        text-transform: uppercase;
        font-size: 11px;
        color: var(--muted);
        text-align: center;
        padding: 10px;
        font-family: var(--font-sans);
      }

      .empty-state {
        display: none;
        text-align: left;
        gap: 10px;
        align-items: start;
        justify-items: start;
        padding: 28px 18px;
        max-width: 520px;
        margin: 0 auto;
        font-family: var(--font-mono);
      }

      .empty-state .empty-title {
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        font-family: var(--font-sans);
        font-weight: 700;
      }

      .empty-state .empty-title::before {
        content: '';
        display: block;
        height: 6px;
        width: 90px;
        margin-bottom: 6px;
        background: repeating-linear-gradient(90deg, var(--ink) 0 2px, transparent 2px 4px);
        opacity: 0.35;
      }

      .empty-state .empty-sub {
        font-size: 12px;
        color: var(--muted);
        max-width: 360px;
      }

      #prep-empty .empty-sub {
        padding-left: 12px;
        border-left: 1px dashed var(--line);
      }

      .empty-state .controls {
        justify-content: flex-start;
      }

      body.plan-empty #prep-empty,
      body.plan-empty #kitchen-empty {
        display: grid;
      }

      body.plan-empty .prep-main #prep-screen {
        display: none;
      }

      body.plan-empty #resources,
      body.plan-empty #line {
        display: none;
      }

      .finish-screen {
        position: fixed;
        inset: 0;
        background: #fff;
        color: #000;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: clamp(1.5rem, 4vw, 3rem);
        text-align: center;
        letter-spacing: 0.08em;
        z-index: 100;
      }

      .finish-screen.show {
        display: flex;
      }

      @keyframes flash {
        0% {
          background: #fff;
        }
        50% {
          background: #f0f0f0;
        }
        100% {
          background: var(--done);
        }
      }

      @media (max-width: 1000px) {
        .line-grid {
          grid-template-columns: 1fr;
        }

        .person-lanes {
          grid-template-columns: 1fr;
        }

        .prep-layout {
          grid-template-columns: 1fr;
        }
      }

      body.compact .assign-row {
        padding: 4px 0;
        font-size: 10px;
      }

      body.compact .lane {
        gap: 6px;
        min-height: 80px;
      }

      body.compact .ticket {
        padding: 6px;
        gap: 3px;
      }

      body.compact .person-column {
        padding: 8px;
        gap: 6px;
      }

      body.compact .person-header {
        padding-bottom: 4px;
      }

      body.mode-kitchen .prep-only {
        display: none;
      }

      body.mode-kitchen .settings-panel {
        display: none;
      }

      body.mode-prep .kitchen-only {
        display: none;
      }

      body.screen-library .prep-only,
      body.screen-library .kitchen-only {
        display: none;
      }

      body.mode-kitchen #advanced-toggle {
        display: none;
      }

      body:not(.expert) .settings-panel .settings-expert-panel {
        display: none;
      }

      body.screen-plan .library-filters {
        display: none;
      }

      body.mode-prep #active-phase,
      body.mode-prep #phase-timer-wrap,
      body.mode-prep #phase-state,
      body.mode-prep #phase-timer-note,
      body.mode-prep #start-service {
        display: none;
      }

      body.mode-kitchen .ticket-meta {
        display: none;
      }

      body.mode-kitchen .ticket {
        padding: 10px;
      }

      body.mode-kitchen .ticket-title {
        font-size: 12px;
      }

      body.mode-kitchen .ticket-line {
        font-size: 11px;
      }

      body.mode-kitchen .person-name {
        font-size: 13px;
      }

      body.mode-kitchen .person-role,
      body.mode-kitchen .person-state {
        font-size: 11px;
      }

      .manual-box {
        display: none;
        margin-top: 6px;
      }

      body.manual-open .manual-box {
        display: block;
      }

      @media (max-width: 980px) {
        .topbar {
          grid-template-columns: 1fr;
        }

        .top-center {
          justify-items: flex-start;
        }

        .status-strip {
          justify-content: flex-start;
        }

        .main-actions {
          justify-content: flex-start;
        }
      }

